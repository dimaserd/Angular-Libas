<div>
  <div style="height: 10px;">
  </div>

  @if (hasImageError) {
    <div class="error-block">
      Изображение не найдено по указанному идентификатору, возможно файл не существует или отсутствует на сервере.
    </div>
  }

  @if (hasFileId() && !hasImageError) {
    <div>
      <img
        [ngStyle]="{ 'max-height': imageMaxHeight}"
        class="mx-auto d-block img-fluid" [src]="getSrc()" (error)="onErrorHandler()"/>
    </div>

    <div>
      <p>Медиа запросы</p>
      @for (request of requests; track $index) {
        <mat-card style="margin: 2px;" class="mat-card">
          <mat-card-content>
            @if (tag.presentOrEdit) {
              <div>
                <span>Граница ширины: {{request.screenWidth}}</span>
                <span>Максимальная высота: {{request.maxImageHeight}}</span>
              </div>
            }

            @if (!tag.presentOrEdit) {
              <div>
                <mat-form-field class="w-100">
                  <mat-label>
                    Граница ширины
                  </mat-label>
                  <input matInput placeholder="Граница ширины"
                         autocomplete="off"
                         [(ngModel)]="request.screenWidth"
                         (ngModelChange)="requestChanged()">
                </mat-form-field>

                <mat-form-field class="w-100">
                  <mat-label>
                    Максимальная высота
                  </mat-label>
                  <input matInput placeholder=" Максимальная высота"
                         autocomplete="off"
                         [(ngModel)]="request.maxImageHeight"
                         (ngModelChange)="requestChanged()">
                </mat-form-field>
              </div>
            }
          </mat-card-content>
        </mat-card>
      }
    </div>
  }

  @if (!hasFileId()) {
    <div>
      <h5>[Изображение не выбрано]</h5>
    </div>
  }
</div>

@if (!tag.presentOrEdit) {
  <div>
    <div style="height: 10px;"></div>
    <div style="overflow-x:auto;">
      <mat-button-toggle-group [(ngModel)]="searchOrEdit">
        <mat-button-toggle value="search">
          Искать файл <mat-icon>search</mat-icon>
        </mat-button-toggle>
        <mat-button-toggle value="edit">
          Указать по идентификатору <mat-icon>settings</mat-icon>
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
    <div style="height: 10px;"></div>
    <div [hidden]="searchOrEdit !== 'search'">
      <croco-html-file-id-select
        [labelText]="'Выбрать файл'"
        [(fileId)]="tag.attributes['file-id']"
        (onFileIdChanged)="onFileIdChanged($event)">
      </croco-html-file-id-select>
    </div>
    <div [hidden]="searchOrEdit !== 'edit'">
      <div>
        <mat-form-field class="w-100">
          <mat-label>
            Идентификатор файла
          </mat-label>
          <input matInput placeholder="Идентификатор файла" new-autocomplete="off" autocomplete="off"
            type="number"
            [(ngModel)]="tag.attributes['file-id']"
            (ngModelChange)="removeImageError()">
        </mat-form-field>
      </div>
    </div>

    <div>
      <mat-form-field class="w-100">
        <mat-label>
          Медиа запрос для высоты изображения
        </mat-label>
        <input matInput placeholder="Граница" new-autocomplete="off" autocomplete="off"
               type="number"
               [(ngModel)]="tag.attributes['file-id']"
               (ngModelChange)="removeImageError()">
        <input matInput placeholder="Идентификатор файла" new-autocomplete="off" autocomplete="off"
               type="number"
               [(ngModel)]="tag.attributes['file-id']"
               (ngModelChange)="removeImageError()">
      </mat-form-field>
    </div>
  </div>
}
